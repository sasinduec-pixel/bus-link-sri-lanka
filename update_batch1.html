<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BusLink - Batch 1 Detailed Update</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-gray-800 p-8 rounded-xl shadow-2xl border border-gray-700">
        <h1 class="text-3xl font-bold mb-2 text-green-400">üîÑ Batch 1: High Density Update</h1>
        <p class="text-gray-400 mb-6">Updating Routes 100-199 with <span class="text-white font-bold">detailed stops</span>.</p>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <input type="text" id="supaUrl" placeholder="Supabase URL" class="bg-gray-900 border border-gray-600 rounded p-2 text-white">
            <input type="text" id="supaKey" placeholder="Anon Key" class="bg-gray-900 border border-gray-600 rounded p-2 text-white">
        </div>

        <button onclick="updateDatabase()" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-lg text-lg">
            üöÄ UPDATE DETAILED STOPS
        </button>

        <div id="logs" class="mt-6 bg-black font-mono text-xs h-96 overflow-y-auto p-4 rounded text-green-400 border border-gray-700">
            Waiting to start...
        </div>
    </div>

    <script>
        // --- DETAILED DATA (Routes 100-199) ---
        // Format: "RouteNo|Stops(Comma Separated)"
        const detailedData = [
            // GALLE ROAD (High Density)
            "100|Panadura Stand,Walana,Keselwatta,Moratuwa Stand,Rawathawatta,Telawala,Ratmalana,Maliban Junc,Templers Rd,Mt Lavinia,Hotel Rd,Dehiwala,William Junc,Wellawatte,Savoy,Bambalapitiya,Kollupitiya,Galle Face,Fort,Pettah",
            "101|Moratuwa Stand,Rawathawatta,Ratmalana,Mt Lavinia,Dehiwala,Wellawatte,Bambalapitiya,Kollupitiya,Galle Face,Pettah",
            
            // HIGH LEVEL ROAD (High Density)
            "138|Pettah,Fort Station,Gamini Hall,Town Hall,Eye Hospital,Lipton Circus,Thunmulla,Havelock Town,Dickmans Rd,Kirulapone,Nugegoda,Delkanda,Navinna,Maharagama,Pannipitiya,Kottawa,Makumbura (Kottawa),Homagama",
            "122|Pettah,Town Hall,Thunmulla,Nugegoda,Delkanda,Maharagama,Kottawa,Homagama,Pitipana,Godagama,Meepe,Waga Junc,Kosgama,Avissawella",
            "125|Pettah,Nugegoda,Maharagama,Kottawa,Godagama,Meepe,Padukka,Ingiriya",

            // HORANA ROAD (High Density)
            "120|Pettah,Reid Avenue,Thunmulla,Havelock Town,Kirulapone,Kohuwala,Pepiliyana,Boralesgamuwa,Werahera,Piliyandala Clock Tower,Kesbewa,Jaliyagoda,Kahathuduwa,Gonapola,Pokunuwita,Horana",
            "162|Pettah,Kohuwala,Boralesgamuwa,Piliyandala Clock Tower,Kesbewa,Bandaragama",

            // KADUWELA / BATTARAMULLA (High Density)
            "177|Kollupitiya,Liberty Plaza,Town Hall,Eye Hospital,Borella,Cotta Rd,Ayurveda Junction,Rajagiriya,Welikada,Ethul Kotte,Battaramulla,Pelawatta,Koswatta,Thalahena,Malabe,Kothalawala,Kaduwela",
            "190|Pettah,Borella,Rajagiriya,Welikada,Battaramulla,Thalangama,Koswatta,Thalahena,Malabe,Athurugiriya,Godagama,Meegoda",
            "170|Pettah,Borella,Rajagiriya,Battaramulla,Pelawatta,Malabe,Athurugiriya",
            "171|Pettah,Borella,Rajagiriya,Battaramulla,Pelawatta",

            // LOW LEVEL ROAD
            "143|Pettah,Orugodawatta,Wellampitiya,Kotikawatta,Kaduwela,Bomiriya,Nawagamuwa,Hanwella",

            // CROSS TOWN LINKS
            "154|Angulana,Ratmalana,Mt Lavinia,Dehiwala,Pamankada,Havelock Town,Thunmulla,Bambalapitiya,Town Hall,Borella,Dematagoda,Peliyagoda,Kiribathgoda",
            "163|Dehiwala,Kalubowila,Kohuwala,Nugegoda,Pita Kotte,Ethul Kotte,Rajagiriya,Battaramulla",
            "176|Karagampitiya,Dehiwala,Kalubowila,Kohuwala,Nugegoda,Narahenpita,Borella,Town Hall,Maradana,Kotahena,Hettiyawatta",
            "155|Soysapura,Moratuwa Stand,Ratmalana,Mt Lavinia,Dehiwala,Wellawatte,Bambalapitiya,Kollupitiya,Pettah,Kotahena,Mattakkuliya",
            "183|Panadura Stand,Walana,Moratuwa Stand,Ratmalana,Maliban Junc,Boralesgamuwa,Piliyandala Clock Tower,Nugegoda",
            "255|Mt Lavinia,Templers Rd,Ratmalana,Katubedda Junction,Piliyandala Clock Tower,Siddhamulla,Kottawa",

            // NEGOMBO ROAD
            "187|Pettah,Peliyagoda,Wattala,Mabola,Ja-Ela,Seeduwa,Katunayake,Airport",
            "240|Pettah,Peliyagoda,Wattala,Mabola,Ja-Ela,Seeduwa,Katunayake,Kurana,Negombo",
            
            // SPECIAL FIX FOR ROUTE 400 (Requested by you)
            "400|Aluthgama,Kalutara Bodhiya,Kalutara,Wadduwa,Panadura Stand,Moratuwa Cross,Ratmalana,Mt Lavinia,Dehiwala,Wellawatte,Bambalapitiya,Kollupitiya,Galle Face,Pettah"
        ];

        async function updateDatabase() {
            const url = document.getElementById('supaUrl').value.trim();
            const key = document.getElementById('supaKey').value.trim();
            const logBox = document.getElementById('logs');

            if (!url || !key) { alert("Credentials missing!"); return; }

            const client = supabase.createClient(url, key);
            logBox.innerHTML = "üîå Connecting...\n";

            let success = 0;

            for (const row of detailedData) {
                const parts = row.split('|');
                const routeNo = parts[0];
                const stops = parts[1].split(',').map(s => s.trim());

                logBox.innerHTML += `üîÑ Updating ${routeNo}... `;

                // First, find the route ID
                const { data: existing, error: findError } = await client
                    .from('routes')
                    .select('id')
                    .eq('route_no', routeNo);

                if (findError || !existing || existing.length === 0) {
                    // Route doesn't exist? Insert it with minimal data + Stops
                    // (Or skip depending on preference. Here we insert basic shell)
                    const { error: insertError } = await client.from('routes').insert({
                        route_no: routeNo,
                        name: `Route ${routeNo}`, // Placeholder name
                        stops: stops,
                        type: "NORMAL",
                        description: "Detailed update applied"
                    });
                    if(insertError) logBox.innerHTML += `‚ùå Insert Failed: ${insertError.message}\n`;
                    else { logBox.innerHTML += `‚úÖ Inserted New\n`; success++; }
                } else {
                    // Update existing route with new stops
                    const { error: updateError } = await client
                        .from('routes')
                        .update({ stops: stops })
                        .eq('route_no', routeNo);

                    if (updateError) logBox.innerHTML += `‚ùå Failed: ${updateError.message}\n`;
                    else { logBox.innerHTML += `‚úÖ Updated Stops\n`; success++; }
                }
                
                logBox.scrollTop = logBox.scrollHeight;
            }
            
            logBox.innerHTML += `\nüèÅ BATCH 1 COMPLETE! Updated: ${success} routes.`;
        }
    </script>
</body>
</html>
